<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tim Clicker - Play-to-Earn</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tim-blue: #00C8FF; --dark-bg: #111; --dark-light: #222; --text-white: #fff; --text-light: #ccc;
            --success: #66bb6a; --error: #ff6b6b; --premium: #ffd700; --crypto: #8B5CF6; --ad-color: #FF6B35;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif; background: var(--dark-bg); color: var(--text-white); text-align: center;
            padding: 20px 20px 80px 20px; min-height: 100vh; position: relative;
            -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: manipulation;
        }
        .loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid var(--dark-light); border-top: 5px solid var(--tim-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn {
            background: var(--tim-blue); color: var(--dark-bg); border: none; padding: 15px 30px;
            border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin: 20px 0;
            width: 100%; max-width: 300px;
        }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-premium { background: linear-gradient(45deg, var(--premium), #ff9800); color: black; }
        .btn-crypto { background: linear-gradient(45deg, var(--crypto), #6366F1); color: white; }
        .btn-ad { background: linear-gradient(45deg, var(--ad-color), #FF9500); color: white; }
        .btn-back {
            position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.1); color: var(--text-white);
            border: 1px solid var(--tim-blue); border-radius: 50%; width: 40px; height: 40px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 20px; z-index: 100;
        }
        .game-interface { max-width: 500px; margin: 0 auto; }
        .top-stats {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
            padding: 10px 15px; background: var(--dark-light); border-radius: 15px; border: 2px solid var(--tim-blue);
        }
        .tim-balance, .stars-stat { display: flex; flex-direction: column; align-items: flex-start; }
        .tim-amount, .stars-amount { font-size: 22px; font-weight: bold; color: var(--tim-blue); line-height: 1; }
        .stars-amount { color: var(--premium); }
        .tim-label, .stars-label { font-size: 10px; color: var(--text-light); margin-top: 2px; }
        .click-stats { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .click-stat { display: flex; align-items: center; gap: 5px; font-size: 13px; }
        .click-stat-value { color: var(--tim-blue); font-weight: bold; }
        .click-area {
            width: 80vw; height: 80vw; max-width: 300px; max-height: 300px;
            background: var(--dark-light); border-radius: 50%; margin: 30px auto;
            display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold;
            cursor: pointer; border: 6px solid var(--tim-blue); user-select: none; transition: transform 0.1s;
            touch-action: manipulation; box-shadow: 0 0 30px rgba(0, 200, 255, 0.3);
        }
        .click-area:active { transform: scale(0.95); }
        .bottom-tabs {
            position: fixed; bottom: 0; left: 0; right: 0; background: var(--dark-bg); padding: 10px;
            border-top: 1px solid var(--dark-light); display: flex; justify-content: space-around; z-index: 100;
        }
        .bottom-tab {
            padding: 12px 5px; background: var(--dark-light); border-radius: 8px; cursor: pointer; flex: 1;
            margin: 0 3px; text-align: center; min-width: 0; font-size: 24px; display: flex;
            align-items: center; justify-content: center; transition: all 0.3s;
        }
        .bottom-tab.active { background: var(--tim-blue); color: var(--dark-bg); font-weight: bold; box-shadow: 0 0 15px rgba(0, 200, 255, 0.5); }
        .grid-layout { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0; }
        .grid-card {
            background: var(--dark-light); padding: 15px; border-radius: 10px; cursor: pointer;
            border: 2px solid var(--tim-blue); text-align: center; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 110px; transition: transform 0.2s;
        }
        .grid-card:hover { transform: scale(1.03); }
        .grid-card .card-title { color: var(--tim-blue); font-weight: bold; font-size: 1rem; margin-bottom: 6px; }
        .grid-card .card-desc { color: var(--text-light); font-size: 11px; line-height: 1.3; }
        .card {
            background: var(--dark-light); padding: 15px; margin: 10px 0; border-radius: 10px;
            border-left: 4px solid var(--tim-blue); text-align: left;
        }
        .card-title { color: var(--tim-blue); font-weight: bold; font-size: 1.1rem; }
        .card-cost { color: var(--text-white); font-weight: bold; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 5px; }
        .card-desc { color: var(--text-light); font-size: 13px; margin-bottom: 8px; line-height: 1.4; }
        .input {
            width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 2px solid var(--tim-blue);
            border-radius: 8px; color: white; margin: 10px 0; font-size: 16px;
        }
        .notification {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 25px;
            border-radius: 10px; z-index: 1001; font-weight: bold; max-width: 90%; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { transform: translateX(-50%) translateY(-100%); } to { transform: translateX(-50%) translateY(0); } }
        .notification.success { background: var(--success); } .notification.error { background: var(--error); }
        .notification.premium { background: var(--premium); color: black; }
        .notification.crypto { background: var(--crypto); color: white; } .notification.ad { background: var(--ad-color); color: white; }
        .friend-card {
            background: var(--dark-light); padding: 10px; margin: 6px 0; border-radius: 10px;
            border-left: 3px solid var(--success); display: flex; justify-content: space-between; align-items: center;
        }
        .friend-info { text-align: left; flex: 1; }
        .friend-name { font-weight: bold; color: var(--text-white); font-size: 12px; margin-bottom: 2px; }
        .friend-bonus { color: var(--success); font-size: 11px; }
        .friend-btn {
            background: var(--success); color: white; border: none; padding: 4px 8px; border-radius: 5px;
            cursor: pointer; font-weight: bold; font-size: 11px; min-width: 60px;
        }
        .referral-link, .wallet-address {
            background: rgba(255,255,255,0.1); padding: 8px; border-radius: 8px; font-family: monospace;
            word-break: break-all; margin: 10px 0; cursor: pointer; font-size: 11px;
        }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page-header { display: flex; align-items: center; justify-content: center; margin-bottom: 15px; gap: 10px; }
        .page-title { font-size: 1.3rem; color: var(--tim-blue); font-weight: bold; text-align: center; }
        .fullscreen-page {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--dark-bg); z-index: 200;
            padding: 20px; overflow-y: auto; display: none;
        }
        .fullscreen-page.active { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .fullscreen-content { max-width: 500px; margin: 0 auto; padding-top: 60px; }
        .mrt-badge {
            background: linear-gradient(45deg, #8B5CF6, #6366F1); color: white; padding: 2px 6px;
            border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 5px;
        }
        /* –ö—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä */
        .crypto-card { background: rgba(139, 92, 246, 0.1); border: 2px solid var(--crypto); position: relative; }
        .crypto-card::before { content: "üí∞"; position: absolute; top: 10px; right: 10px; font-size: 16px; }
        .chance-display, .ad-timer {
            background: rgba(0, 0, 0, 0.3); padding: 3px 6px; border-radius: 20px; font-size: 10px;
            margin-top: 4px; color: var(--crypto); font-weight: bold;
        }
        .crypto-effect, .ad-effect {
            position: fixed; font-size: 20px; font-weight: bold; z-index: 1002; pointer-events: none;
            animation: float 2s ease-out forwards;
        }
        .crypto-effect { color: var(--crypto); } .ad-effect { color: var(--ad-color); }
        @keyframes float {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-50px) scale(1.2); opacity: 0.8; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }
        /* –†–µ–∫–ª–∞–º–∞ */
        .ad-card { background: rgba(255, 107, 53, 0.1); border: 2px solid var(--ad-color); position: relative; }
        .ad-card::before { content: "üì∫"; position: absolute; top: 10px; right: 10px; font-size: 16px; }
        .ad-timer { color: var(--ad-color); }
        .ad-watch-progress { width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .ad-watch-fill { height: 100%; background: var(--ad-color); transition: width 0.3s ease; }
        /* Telegram Stars - –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å */
        .stars-section { background: var(--dark-light); padding: 12px; border-radius: 10px; margin: 8px 0; border: 2px solid var(--premium); }
        .stars-balance { text-align: center; margin-bottom: 15px; }
        .balance-amount { font-size: 28px; font-weight: bold; color: var(--premium); margin: 8px 0; }
        .balance-label { color: var(--text-light); font-size: 12px; }
        .stars-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin: 12px 0; }
        .stars-package {
            background: rgba(255, 215, 0, 0.1); border: 1px solid var(--premium); border-radius: 8px;
            padding: 10px; cursor: pointer; transition: all 0.2s; text-align: center;
        }
        .stars-package:hover { transform: translateY(-2px); background: rgba(255, 215, 0, 0.15); }
        .stars-icon { font-size: 20px; margin-bottom: 3px; }
        .stars-count { font-size: 14px; font-weight: bold; color: var(--premium); }
        /* TIM –∑–∞ –∑–≤–µ–∑–¥—ã - —Ç–∞–∫–æ–π –∂–µ —Å—Ç–∏–ª—å –∫–∞–∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ */
        .tim-packages-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin: 12px 0; }
        .tim-package-compact {
            background: rgba(0, 200, 255, 0.1); border: 1px solid var(--tim-blue); border-radius: 8px;
            padding: 10px; cursor: pointer; transition: all 0.2s; text-align: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .tim-package-compact:hover { transform: translateY(-2px); background: rgba(0, 200, 255, 0.15); }
        .tim-cost { font-size: 16px; font-weight: bold; color: var(--premium); display: flex; align-items: center; justify-content: center; gap: 4px; margin-bottom: 4px; }
        .tim-reward { font-size: 14px; font-weight: bold; color: var(--tim-blue); margin-bottom: 2px; }
        .tim-benefit { font-size: 10px; color: var(--text-light); }
        .section-title {
            color: var(--tim-blue); font-weight: bold; font-size: 1.1rem; margin-bottom: 12px;
            text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥—Ä—É–∑–µ–π - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ */
        .bonus-info {
            background: rgba(102, 187, 106, 0.1); border: 1px solid var(--success); border-radius: 8px;
            padding: 10px; margin: 8px 0; text-align: left;
        }
        .bonus-list { margin: 8px 0; padding-left: 18px; }
        .bonus-list li { margin: 3px 0; font-size: 11px; color: var(--text-light); line-height: 1.3; }
        .referral-stats {
            display: flex; justify-content: space-between; margin: 12px 0;
            background: rgba(0, 200, 255, 0.1); padding: 8px; border-radius: 8px;
        }
        .stat-item { text-align: center; flex: 1; }
        .stat-value { font-size: 16px; font-weight: bold; color: var(--tim-blue); }
        .stat-label { font-size: 10px; color: var(--text-light); margin-top: 2px; }
        /* –°—Ç–∏–ª—å –¥–ª—è –æ—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–∫–∞ */
        .offline-earnings {
            background: rgba(0, 200, 255, 0.1); border: 1px solid var(--tim-blue); border-radius: 10px;
            padding: 10px; margin: 8px 0; text-align: center; cursor: pointer;
        }
        .offline-earnings .card-title { color: var(--tim-blue); font-weight: bold; font-size: 14px; }
        .offline-earnings .card-desc { color: var(--text-light); font-size: 11px; }
        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥—Ä—É–∑–µ–π */
        .compact-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .compact-card {
            background: var(--dark-light); padding: 12px; border-radius: 8px; cursor: pointer;
            border: 2px solid var(--tim-blue); text-align: center; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 90px;
        }
        .compact-card .card-title { color: var(--tim-blue); font-weight: bold; font-size: 13px; margin-bottom: 4px; }
        .compact-card .card-desc { color: var(--text-light); font-size: 10px; line-height: 1.2; }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading" v-if="!isReady">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
        </div>

        <div class="game-interface" v-if="isReady">
            <!-- –û—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–æ–∫ -->
            <div v-if="offlineEarnings > 0" class="offline-earnings" @click="claimOfflineEarnings">
                <div class="card-title">üí∞ –û—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–æ–∫</div>
                <div class="card-desc">–ü–æ–∫–∞ –≤–∞—Å –Ω–µ –±—ã–ª–æ: +{{ formatNumber(offlineEarnings) }} TIM</div>
                <div class="card-desc" style="font-size: 9px; color: var(--tim-blue);">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å</div>
            </div>

            <div class="top-stats">
                <div class="tim-balance">
                    <div class="tim-amount">{{ formatNumber(coins) }}</div>
                    <div class="tim-label">TIM</div>
                </div>
                <div class="click-stats">
                    <div class="click-stat">
                        <span>üëÜ</span>
                        <span class="click-stat-value">+{{ profitPerTap.toFixed(1) }}</span>
                    </div>
                    <div class="click-stat">
                        <span>‚è±Ô∏è</span>
                        <span class="click-stat-value">{{ autoClickers }}/–º–∏–Ω</span>
                    </div>
                </div>
                <div class="stars-stat">
                    <div class="stars-amount">‚≠ê {{ telegramStars }}</div>
                    <div class="stars-label">STARS</div>
                </div>
            </div>

            <!-- –ü–æ—Ä—è–¥–æ–∫ –≤–∫–ª–∞–¥–æ–∫: –¥—Ä—É–∑—å—è ‚Üí —É–ª—É—á—à–µ–Ω–∏—è ‚Üí –∫–ª–∏–∫–µ—Ä ‚Üí —Ä–µ–∫–ª–∞–º–∞ ‚Üí —Ç–æ–∫–µ–Ω—ã -->
            <div class="page" :class="{active: activePage === 'friends'}">
                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="referral-stats">
                    <div class="stat-item">
                        <div class="stat-value">{{ friends.length }}</div>
                        <div class="stat-label">–î—Ä—É–∑–µ–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ formatNumber(totalReferralEarnings) }}</div>
                        <div class="stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">+{{ totalPassiveEarnings.toFixed(1) }}</div>
                        <div class="stat-label">TIM/–∫–ª–∏–∫</div>
                    </div>
                </div>

                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="compact-grid">
                    <div class="compact-card" @click="generateInvite">
                        <div style="font-size: 24px;">üì§</div>
                        <div class="card-title">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</div>
                        <div class="card-desc">–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å</div>
                    </div>
                    <div class="compact-card" @click="copyReferral">
                        <div style="font-size: 24px;">üîó</div>
                        <div class="card-title">–°—Å—ã–ª–∫–∞</div>
                        <div class="card-desc">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
                    </div>
                </div>

                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ–Ω—É—Å–∞—Ö -->
                <div class="bonus-info">
                    <div class="card-title" style="color: var(--success); font-size: 14px;">üéÅ –ë–æ–Ω—É—Å—ã –∑–∞ –¥—Ä—É–∑–µ–π:</div>
                    <ul class="bonus-list">
                        <li><strong>1-5 –¥—Ä—É–∑–µ–π:</strong> 50K TIM</li>
                        <li><strong>6+ –¥—Ä—É–∑–µ–π:</strong> 10K TIM</li>
                        <li><strong>–ü–∞—Å—Å–∏–≤–Ω–æ:</strong> 1% –æ—Ç –¥–æ—Ö–æ–¥–∞ –¥—Ä—É–≥–∞</li>
                        <li><strong>1M TIM —É –¥—Ä—É–≥–∞:</strong> +10K –±–æ–Ω—É—Å</li>
                    </ul>
                </div>

                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π -->
                <div v-if="friends.length > 0">
                    <div style="text-align: left; margin: 10px 0;">
                        <div style="color: var(--tim-blue); font-weight: bold; font-size: 14px;">üë• –î—Ä—É–∑—å—è ({{ friends.length }})</div>
                        <div style="color: var(--text-light); font-size: 11px;">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥: +{{ totalPassiveEarnings.toFixed(1) }} TIM/–∫–ª–∏–∫</div>
                    </div>
                    <div v-for="friend in friends" :key="friend.id" class="friend-card">
                        <div class="friend-info">
                            <div class="friend-name">{{ friend.name }}</div>
                            <div style="color: var(--text-light); font-size: 10px;">–£—Ä. {{ friend.level }}</div>
                            <div class="friend-bonus">+{{ friend.passiveIncome.toFixed(2) }}/–∫–ª–∏–∫</div>
                        </div>
                        <button class="friend-btn" @click="claimFriendBonus(friend.id)" v-if="!friend.bonusClaimed && friend.canClaim">
                            –ó–∞–±—Ä–∞—Ç—å
                        </button>
                        <div v-else-if="friend.bonusClaimed" style="color: var(--success); font-weight: bold; font-size: 12px;">‚úÖ</div>
                    </div>
                </div>
            </div>

            <div class="page" :class="{active: activePage === 'upgrades'}">
                <div class="grid-layout">
                    <div class="grid-card" @click="buyUpgrade(1)">
                        <div class="card-title">{{ upgrades[0].name }}</div>
                        <div class="card-cost">{{ formatNumber(upgrades[0].cost) }} TIM</div>
                        <div class="card-desc">{{ upgrades[0].description }}</div>
                        <div class="card-desc">–£—Ä–æ–≤–µ–Ω—å: {{ upgrades[0].level }}</div>
                    </div>
                    <div class="grid-card" @click="buyUpgrade(2)">
                        <div class="card-title">{{ upgrades[1].name }}</div>
                        <div class="card-cost">{{ formatNumber(upgrades[1].cost) }} TIM</div>
                        <div class="card-desc">{{ upgrades[1].description }}</div>
                        <div class="card-desc">–£—Ä–æ–≤–µ–Ω—å: {{ upgrades[1].level }}</div>
                    </div>
                    <div class="grid-card" @click="buyUpgrade(3)">
                        <div class="card-title">{{ upgrades[2].name }}</div>
                        <div class="card-cost">{{ formatNumber(upgrades[2].cost) }} TIM</div>
                        <div class="card-desc">{{ upgrades[2].description }}</div>
                        <div class="card-desc">–£—Ä–æ–≤–µ–Ω—å: {{ upgrades[2].level }}</div>
                    </div>
                    <div class="grid-card crypto-card" @click="activateCryptoMiner">
                        <div class="card-title" style="color: var(--crypto);">–ö—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä</div>
                        <div class="card-cost">{{ formatNumber(cryptoMinerCost) }} TIM</div>
                        <div class="card-desc">–®–∞–Ω—Å –Ω–∞–π—Ç–∏ 1 MRT –ø—Ä–∏ –∫–ª–∏–∫–µ</div>
                        <div class="chance-display" v-if="cryptoMinerActive && cryptoMinerTimeLeft > 0">
                            –†–∞–±–æ—Ç–∞–µ—Ç: {{ cryptoMinerTimeLeft }} —Å–µ–∫
                        </div>
                        <div class="chance-display" v-else>
                            –®–∞–Ω—Å: {{ (currentCryptoChance * 100).toFixed(4) }}%
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" :class="{active: activePage === 'click'}">
                <div class="click-area" @click="mine">
                    CLICK
                </div>
            </div>

            <div class="page" :class="{active: activePage === 'ads'}">
                <!-- –£–±—Ä–∞–Ω–æ –≤–µ—Ä—Ö–Ω–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–∫–Ω–æ -->
                
                <div class="grid-layout">
                    <div class="grid-card ad-card" @click="watchAd('daily')">
                        <div class="card-title" style="color: var(--ad-color);">üì∫ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è</div>
                        <div class="card-desc" v-if="!ads.daily.available">
                            –ß–µ—Ä–µ–∑: {{ formatTime(ads.daily.cooldown) }}
                        </div>
                        <div class="card-desc" v-else>
                            –ù–∞–≥—Ä–∞–¥–∞: {{ formatNumber(ads.daily.reward) }} TIM
                        </div>
                        <div class="ad-timer">{{ ads.daily.watchedToday }}/3 —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    <div class="grid-card ad-card" @click="watchAd('hourly')">
                        <div class="card-title" style="color: var(--ad-color);">‚è∞ –ß–∞—Å–æ–≤–∞—è</div>
                        <div class="card-desc" v-if="!ads.hourly.available">
                            –ß–µ—Ä–µ–∑: {{ formatTime(ads.hourly.cooldown) }}
                        </div>
                        <div class="card-desc" v-else>
                            –ù–∞–≥—Ä–∞–¥–∞: {{ formatNumber(ads.hourly.reward) }} TIM
                        </div>
                    </div>
                    <div class="grid-card ad-card" @click="watchAd('big')">
                        <div class="card-title" style="color: var(--ad-color);">üéÅ –ë–æ–ª—å—à–∞—è</div>
                        <div class="card-desc" v-if="!ads.big.available">–ó–∞–≤—Ç—Ä–∞</div>
                        <div class="card-desc" v-else>–ù–∞–≥—Ä–∞–¥–∞: {{ formatNumber(ads.big.reward) }} TIM</div>
                    </div>
                    <div class="grid-card ad-card" @click="watchAd('instant')">
                        <div class="card-title" style="color: var(--ad-color);">‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è</div>
                        <div class="card-desc">–ù–∞–≥—Ä–∞–¥–∞: {{ formatNumber(ads.instant.reward) }} TIM</div>
                        <div class="ad-timer">–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</div>
                    </div>
                </div>
                
                <div v-if="adWatching.active" class="card" style="padding: 12px; margin-top: 15px;">
                    <div class="card-title">üì∫ –°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∫–ª–∞–º—É...</div>
                    <div class="card-desc">–û—Å—Ç–∞–ª–æ—Å—å: {{ adWatching.timeLeft }} —Å–µ–∫.</div>
                    <div class="ad-watch-progress">
                        <div class="ad-watch-fill" :style="{width: adWatching.progress + '%'}"></div>
                    </div>
                </div>
                
                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã -->
                <div class="card" style="padding: 12px; margin-top: 15px;">
                    <div class="card-title" style="font-size: 14px;">üí∞ –í—Å–µ–≥–æ –∑–∞ —Ä–µ–∫–ª–∞–º—É</div>
                    <div class="card-desc" style="font-size: 16px; font-weight: bold; color: var(--ad-color);">{{ formatNumber(totalAdEarnings) }} TIM</div>
                </div>
            </div>

            <div class="page" :class="{active: activePage === 'tokens'}">
                <div class="grid-layout">
                    <div class="grid-card" @click="openFullscreen('convert')">
                        <div style="font-size: 28px;">üí±</div>
                        <div class="card-title">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è</div>
                        <div class="card-desc">1,000,000 TIM = 1 MRT</div>
                    </div>
                    <div class="grid-card" @click="openFullscreen('withdraw')">
                        <div style="font-size: 28px;">üí∞</div>
                        <div class="card-title">–í—ã–≤–æ–¥ <span class="mrt-badge">MRT</span></div>
                        <div class="card-desc">–ú–∏–Ω–∏–º—É–º 10 MRT</div>
                    </div>
                    <div class="grid-card" @click="openFullscreen('wallet')">
                        <div style="font-size: 28px;">üëõ</div>
                        <div class="card-title">–ö–æ—à–µ–ª–µ–∫</div>
                        <div class="card-desc">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–ø–ª–∞—Ç</div>
                    </div>
                    <div class="grid-card" @click="openFullscreen('stars')">
                        <div style="font-size: 28px;">‚≠ê</div>
                        <div class="card-title">Telegram Stars</div>
                        <div class="card-desc">–ü–æ–∫—É–ø–∫–∞ –∏ –ø—Ä–µ–º–∏—É–º</div>
                    </div>
                </div>
            </div>

            <!-- Telegram Stars Fullscreen -->
            <div class="fullscreen-page" :class="{active: fullscreenPage === 'stars'}">
                <button class="btn-back" @click="closeFullscreen">‚Üê</button>
                <div class="fullscreen-content">
                    <div class="page-header">
                        <div style="font-size: 36px;">‚≠ê</div>
                        <div class="page-title">Telegram Stars</div>
                    </div>
                    
                    <div class="stars-section">
                        <div class="stars-balance">
                            <div class="balance-amount">‚≠ê {{ telegramStars }}</div>
                            <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å –∑–≤–µ–∑–¥</div>
                        </div>
                    </div>

                    <div class="stars-section">
                        <div class="section-title">
                            <span>üíé</span>
                            <span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</span>
                        </div>
                        <div class="stars-grid">
                            <div class="stars-package" @click="buyStars(100)">
                                <div class="stars-icon">‚≠ê</div>
                                <div class="stars-count">100</div>
                            </div>
                            <div class="stars-package" @click="buyStars(500)">
                                <div class="stars-icon">‚≠ê</div>
                                <div class="stars-count">500</div>
                            </div>
                            <div class="stars-package" @click="buyStars(1000)">
                                <div class="stars-icon">‚≠ê</div>
                                <div class="stars-count">1000</div>
                            </div>
                            <div class="stars-package" @click="buyStars(5000)">
                                <div class="stars-icon">‚≠ê</div>
                                <div class="stars-count">5000</div>
                            </div>
                        </div>
                    </div>

                    <div class="stars-section">
                        <div class="section-title">
                            <span>ü™ô</span>
                            <span>–ö—É–ø–∏—Ç—å TIM –∑–∞ –∑–≤–µ–∑–¥—ã</span>
                        </div>
                        <div class="tim-packages-grid">
                            <div class="tim-package-compact" @click="buyTimForStars(50, 1000000)">
                                <div class="tim-cost">
                                    <span>‚≠ê</span>
                                    <span>50</span>
                                </div>
                                <div class="tim-reward">1,000,000 TIM</div>
                                <div class="tim-benefit">–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç</div>
                            </div>
                            <div class="tim-package-compact" @click="buyTimForStars(100, 3000000)">
                                <div class="tim-cost">
                                    <span>‚≠ê</span>
                                    <span>100</span>
                                </div>
                                <div class="tim-reward">3,000,000 TIM</div>
                                <div class="tim-benefit">+200% –≤—ã–≥–æ–¥—ã</div>
                            </div>
                            <div class="tim-package-compact" @click="buyTimForStars(200, 8000000)">
                                <div class="tim-cost">
                                    <span>‚≠ê</span>
                                    <span>200</span>
                                </div>
                                <div class="tim-reward">8,000,000 TIM</div>
                                <div class="tim-benefit">+300% –≤—ã–≥–æ–¥—ã</div>
                            </div>
                            <div class="tim-package-compact" @click="buyTimForStars(500, 25000000)">
                                <div class="tim-cost">
                                    <span>‚≠ê</span>
                                    <span>500</span>
                                </div>
                                <div class="tim-reward">25,000,000 TIM</div>
                                <div class="tim-benefit">+400% –≤—ã–≥–æ–¥—ã</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è TIM –≤ MRT -->
            <div class="fullscreen-page" :class="{active: fullscreenPage === 'convert'}">
                <button class="btn-back" @click="closeFullscreen">‚Üê</button>
                <div class="fullscreen-content">
                    <div class="page-header">
                        <div style="font-size: 36px;">üí±</div>
                        <div class="page-title">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è TIM ‚Üí MRT</div>
                    </div>
                    <div class="card">
                        <div class="card-desc">–í–∞—à–∏ —Ç–æ–∫–µ–Ω—ã: {{ realTokens }} <span class="mrt-badge">MRT</span></div>
                        <div class="card-desc">–í–∞—à–∏ –º–æ–Ω–µ—Ç—ã: {{ formatNumber(coins) }} TIM</div>
                        <div class="card-desc">–ö—É—Ä—Å: 1,000,000 TIM = 1 MRT</div>
                        <input type="number" class="input" v-model.number="convertAmount" placeholder="–°—É–º–º–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏" min="1000000">
                        <button class="btn" @click="convertTokens" :disabled="convertAmount < 1000000 || coins < convertAmount">
                            –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ MRT
                        </button>
                    </div>
                </div>
            </div>

            <!-- –í—ã–≤–æ–¥ MRT —Ç–æ–∫–µ–Ω–æ–≤ -->
            <div class="fullscreen-page" :class="{active: fullscreenPage === 'withdraw'}">
                <button class="btn-back" @click="closeFullscreen">‚Üê</button>
                <div class="fullscreen-content">
                    <div class="page-header">
                        <div style="font-size: 36px;">üí∞</div>
                        <div class="page-title">–í—ã–≤–æ–¥ MRT —Ç–æ–∫–µ–Ω–æ–≤</div>
                    </div>
                    <div class="card">
                        <div class="card-desc">–í–∞—à–∏ —Ç–æ–∫–µ–Ω—ã: {{ realTokens }} <span class="mrt-badge">MRT</span></div>
                        <div class="card-desc">–ú–∏–Ω–∏–º—É–º –¥–ª—è –≤—ã–≤–æ–¥–∞: 10 MRT</div>
                        <input type="number" class="input" v-model.number="withdrawAmount" placeholder="–°—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞" min="10">
                        <button class="btn" @click="withdrawTokens" :disabled="withdrawAmount < 10 || realTokens < withdrawAmount">
                            –í—ã–≤–µ—Å—Ç–∏ MRT
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ö–æ—à–µ–ª–µ–∫ Polygon -->
            <div class="fullscreen-page" :class="{active: fullscreenPage === 'wallet'}">
                <button class="btn-back" @click="closeFullscreen">‚Üê</button>
                <div class="fullscreen-content">
                    <div class="page-header">
                        <div style="font-size: 36px;">üëõ</div>
                        <div class="page-title">–ö–æ—à–µ–ª–µ–∫ Polygon</div>
                    </div>
                    <div class="card">
                        <div class="card-desc">–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ MRT</div>
                        <input type="text" class="input" v-model="polygonWalletInput" placeholder="0x..." @keyup.enter="saveWallet">
                        <button class="btn" @click="saveWallet" :disabled="!isValidWallet">
                            {{ polygonWalletAddress ? '–û–±–Ω–æ–≤–∏—Ç—å' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' }}
                        </button>
                        <div v-if="polygonWalletAddress" style="margin-top: 20px;">
                            <div class="card-desc">–¢–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å:</div>
                            <div class="wallet-address" @click="copyWallet">{{ polygonWalletAddress }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∏ –≤ –Ω–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ: –¥—Ä—É–∑—å—è ‚Üí —É–ª—É—á—à–µ–Ω–∏—è ‚Üí –∫–ª–∏–∫–µ—Ä ‚Üí —Ä–µ–∫–ª–∞–º–∞ ‚Üí —Ç–æ–∫–µ–Ω—ã -->
            <div class="bottom-tabs">
                <div class="bottom-tab" :class="{active: activePage === 'friends'}" @click="setPage('friends')" title="–î—Ä—É–∑—å—è">üë•</div>
                <div class="bottom-tab" :class="{active: activePage === 'upgrades'}" @click="setPage('upgrades')" title="–£–ª—É—á—à–µ–Ω–∏—è">‚ö°</div>
                <div class="bottom-tab" :class="{active: activePage === 'click'}" @click="setPage('click')" title="–ö–ª–∏–∫–µ—Ä">üëÜ</div>
                <div class="bottom-tab" :class="{active: activePage === 'ads'}" @click="setPage('ads')" title="–†–µ–∫–ª–∞–º–∞">üì∫</div>
                <div class="bottom-tab" :class="{active: activePage === 'tokens'}" @click="setPage('tokens')" title="–¢–æ–∫–µ–Ω—ã">üí∞</div>
            </div>
        </div>

        <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã –∫—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä–∞ -->
        <div v-for="(effect, index) in cryptoEffects" :key="index" 
             class="crypto-effect"
             :style="{left: effect.x + 'px', top: effect.y + 'px'}">+1 MRT</div>
        
        <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–µ–∫–ª–∞–º—ã -->
        <div v-for="(effect, index) in adEffects" :key="'ad-' + index" 
             class="ad-effect"
             :style="{left: effect.x + 'px', top: effect.y + 'px'}">+{{ formatNumber(effect.amount) }}</div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div class="notification success" v-if="notification.show && notification.type === 'success'">{{ notification.message }}</div>
        <div class="notification error" v-if="notification.show && notification.type === 'error'">{{ notification.message }}</div>
        <div class="notification premium" v-if="notification.show && notification.type === 'premium'">{{ notification.message }}</div>
        <div class="notification crypto" v-if="notification.show && notification.type === 'crypto'">{{ notification.message }}</div>
        <div class="notification ad" v-if="notification.show && notification.type === 'ad'">{{ notification.message }}</div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        
        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        const StorageManager = {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            generateUserId() {
                let userId = localStorage.getItem('tim_user_id');
                if (!userId) {
                    const timestamp = Date.now();
                    const random = Math.random().toString(36).substr(2, 9);
                    const userAgentHash = navigator.userAgent.length % 100;
                    userId = `tim_user_${timestamp}_${random}_${userAgentHash}`;
                    localStorage.setItem('tim_user_id', userId);
                }
                return userId;
            },
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            getUserStorageKey(userId) {
                return `tim_clicker_save_${userId}`;
            },
            
            // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–±–∞–∑–æ–≤–æ–µ)
            encryptData(data) {
                try {
                    const json = JSON.stringify(data);
                    const timestamp = Date.now();
                    const salt = Math.random().toString(36).substring(2, 10);
                    const combined = json + '|' + timestamp + '|' + salt;
                    const encoded = btoa(unescape(encodeURIComponent(combined)));
                    const reversed = encoded.split('').reverse().join('');
                    return reversed;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:', e);
                    return '';
                }
            },
            
            // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            decryptData(encoded) {
                try {
                    if (!encoded) return null;
                    const reversed = encoded.split('').reverse().join('');
                    const decoded = decodeURIComponent(escape(atob(reversed)));
                    const parts = decoded.split('|');
                    if (parts.length < 3) return null;
                    
                    const data = JSON.parse(parts[0]);
                    const timestamp = parseInt(parts[1]);
                    const salt = parts[2];
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–æ–µ (–º–∞–∫—Å 30 –¥–Ω–µ–π)
                    if (Date.now() - timestamp > 30 * 24 * 60 * 60 * 1000) {
                        console.warn('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–æ–µ');
                        return null;
                    }
                    
                    return data;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:', e);
                    return null;
                }
            },
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
            validateGameData(data) {
                if (!data || typeof data !== 'object') return false;
                
                // –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                const requiredFields = ['coins', 'profitPerTap', 'autoClickers', 'userId'];
                for (const field of requiredFields) {
                    if (!(field in data)) return false;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –∏ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                if (typeof data.coins !== 'number' || data.coins < 0 || data.coins > 1000000000000) return false;
                if (typeof data.profitPerTap !== 'number' || data.profitPerTap < 0 || data.profitPerTap > 1000000) return false;
                if (typeof data.autoClickers !== 'number' || data.autoClickers < 0 || data.autoClickers > 1000000) return false;
                if (typeof data.userId !== 'string') return false;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                if (data.telegramStars && (typeof data.telegramStars !== 'number' || data.telegramStars < 0 || data.telegramStars > 1000000)) return false;
                if (data.realTokens && (typeof data.realTokens !== 'number' || data.realTokens < 0 || data.realTokens > 1000000)) return false;
                if (data.cryptoMinerLevel && (typeof data.cryptoMinerLevel !== 'number' || data.cryptoMinerLevel < 0 || data.cryptoMinerLevel > 1000)) return false;
                
                return true;
            },
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            saveProgress(userId, gameData) {
                try {
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                    const saveData = {
                        ...gameData,
                        version: '1.2.0',
                        saveTimestamp: Date.now(),
                        saveCount: (gameData.saveCount || 0) + 1
                    };
                    
                    // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                    if (!this.validateGameData(saveData)) {
                        console.error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                        return false;
                    }
                    
                    // –®–∏—Ñ—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                    const encrypted = this.encryptData(saveData);
                    const storageKey = this.getUserStorageKey(userId);
                    localStorage.setItem(storageKey, encrypted);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                    localStorage.setItem('tim_last_backup', encrypted);
                    
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                    return false;
                }
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            loadProgress(userId) {
                try {
                    const storageKey = this.getUserStorageKey(userId);
                    const encrypted = localStorage.getItem(storageKey);
                    
                    if (!encrypted) {
                        console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
                        return null;
                    }
                    
                    const gameData = this.decryptData(encrypted);
                    
                    if (!gameData || !this.validateGameData(gameData)) {
                        console.warn('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                        
                        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                        const backup = localStorage.getItem('tim_last_backup');
                        if (backup) {
                            const backupData = this.decryptData(backup);
                            if (backupData && this.validateGameData(backupData)) {
                                return backupData;
                            }
                        }
                        
                        return null;
                    }
                    
                    return gameData;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                    return null;
                }
            },
            
            // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            clearProgress(userId) {
                try {
                    const storageKey = this.getUserStorageKey(userId);
                    localStorage.removeItem(storageKey);
                    localStorage.removeItem('tim_last_backup');
                    localStorage.removeItem('tim_user_id');
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏:', error);
                    return false;
                }
            }
        };
        
        createApp({
            setup() {
                // –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                const isReady = ref(false);
                const coins = ref(0);
                const profitPerTap = ref(1);
                const autoClickers = ref(0);
                const activePage = ref('click');
                const fullscreenPage = ref('');
                const realTokens = ref(0);
                const polygonWalletAddress = ref('');
                const polygonWalletInput = ref('');
                const convertAmount = ref('');
                const withdrawAmount = ref('');
                const friends = ref([]);
                const userId = ref('');
                const telegramStars = ref(0);
                const cryptoMinerLevel = ref(0);
                const cryptoMinerActive = ref(false);
                const cryptoMinerEndTime = ref(0);
                const cryptoMinerChance = ref(0.00001);
                const cryptoEffects = ref([]);
                const ads = ref({
                    daily: { available: true, reward: 50000, cooldown: 0, watchedToday: 0, lastWatch: 0 },
                    hourly: { available: true, reward: 10000, cooldown: 0, lastWatch: 0 },
                    big: { available: true, reward: 200000, lastWatch: 0 },
                    instant: { available: true, reward: 5000, lastWatch: 0 }
                });
                const adWatching = ref({ active: false, timeLeft: 30, progress: 0, type: '' });
                const totalAdEarnings = ref(0);
                const totalReferralEarnings = ref(0);
                const adEffects = ref([]);
                const notification = ref({ show: false, message: '', type: 'success' });
                const lastClickTime = ref(0);
                const clickTimes = ref([]); // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–∫–æ–≤
                const clickCooldown = 100;
                const upgrades = ref([
                    { id: 1, name: '–£—Å–∏–ª–∏—Ç–µ–ª—å –∫–ª–∏–∫–∞', description: '+0.5 TIM –∑–∞ –∫–ª–∏–∫', cost: 1000, level: 0 },
                    { id: 2, name: '–ê–≤—Ç–æ–º–∞–π–Ω–µ—Ä', description: '+5 TIM –≤ –º–∏–Ω—É—Ç—É', cost: 5000, level: 0 },
                    { id: 3, name: '–ú–Ω–æ–∂–∏—Ç–µ–ª—å', description: 'x1.5 –¥–æ—Ö–æ–¥ –æ—Ç –∫–ª–∏–∫–æ–≤', cost: 25000, level: 0 }
                ]);
                
                // –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞—â–∏—Ç—ã
                const lastSaveTime = ref(Date.now());
                const offlineEarnings = ref(0);
                const saveCount = ref(0);
                const hasShownWelcome = ref(false); // –§–ª–∞–≥ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –æ–¥–∏–Ω —Ä–∞–∑
                
                // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
                const totalPassiveEarnings = computed(() => {
                    return friends.value.reduce((sum, friend) => {
                        return sum + (friend.passiveIncome || 0);
                    }, 0);
                });
                
                const offlineIncomePerMinute = computed(() => {
                    return autoClickers.value;
                });
                
                const isValidWallet = computed(() => {
                    const addr = polygonWalletInput.value.trim();
                    return /^0x[a-fA-F0-9]{40}$/.test(addr);
                });
                
                const currentCryptoChance = computed(() => {
                    return cryptoMinerChance.value * (1 + cryptoMinerLevel.value * 0.5);
                });
                
                const cryptoMinerTimeLeft = computed(() => {
                    if (!cryptoMinerActive.value) return 0;
                    const now = Date.now();
                    const timeLeft = cryptoMinerEndTime.value - now;
                    return timeLeft > 0 ? Math.ceil(timeLeft / 1000) : 0;
                });
                
                const cryptoMinerCost = computed(() => {
                    return 100000 + (cryptoMinerLevel.value * 50000);
                });
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
                function formatNumber(num) {
                    if (num >= 1000000000) return (num / 1000000000).toFixed(2) + 'B';
                    if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
                    if (num >= 1000) return (num / 1000).toFixed(2) + 'K';
                    return Math.floor(num);
                }
                
                function formatTime(seconds) {
                    if (seconds >= 3600) return Math.floor(seconds / 3600) + '—á';
                    if (seconds >= 60) return Math.floor(seconds / 60) + '–º';
                    return seconds + '—Å';
                }
                
                function showNotify(msg, type = 'success') {
                    notification.value = { show: true, message: msg, type };
                    setTimeout(() => notification.value.show = false, 3000);
                }
                
                // –≠—Ñ—Ñ–µ–∫—Ç—ã
                function addCryptoEffect(x, y) {
                    cryptoEffects.value.push({ x, y });
                    setTimeout(() => cryptoEffects.value.shift(), 2000);
                }
                
                function addAdEffect(x, y, amount) {
                    adEffects.value.push({ x, y, amount });
                    setTimeout(() => adEffects.value.shift(), 2000);
                }
                
                // –†–∞—Å—á–µ—Ç –æ—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–∫–∞
                function calculateOfflineEarnings() {
                    const now = Date.now();
                    const timeDiff = now - lastSaveTime.value;
                    
                    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ñ–ª–∞–π–Ω - 24 —á–∞—Å–∞
                    const maxOfflineTime = 24 * 60 * 60 * 1000;
                    const effectiveTime = Math.min(timeDiff, maxOfflineTime);
                    
                    // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    if (effectiveTime < 0) return 0;
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∏–Ω—É—Ç—ã
                    const minutesOffline = effectiveTime / (1000 * 60);
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä–∞–±–æ—Ç–æ–∫
                    const earnings = Math.floor(offlineIncomePerMinute.value * minutesOffline);
                    
                    // –õ–∏–º–∏—Ç –Ω–∞ –æ—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–æ–∫
                    const maxOfflineEarnings = 1000000;
                    return Math.min(earnings, maxOfflineEarnings);
                }
                
                function claimOfflineEarnings() {
                    if (offlineEarnings.value > 0) {
                        coins.value += offlineEarnings.value;
                        showNotify(`üí∞ –ü–æ–ª—É—á–µ–Ω–æ ${formatNumber(offlineEarnings.value)} TIM –æ—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–∫–∞!`, 'success');
                        offlineEarnings.value = 0;
                        lastSaveTime.value = Date.now();
                        saveGame();
                    }
                }
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
                function mine() {
                    const now = Date.now();
                    
                    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤
                    clickTimes.value.push(now);
                    if (clickTimes.value.length > 10) {
                        clickTimes.value.shift();
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
                    if (now - lastClickTime.value < clickCooldown) return;
                    
                    lastClickTime.value = now;
                    
                    // –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫
                    let earned = profitPerTap.value;
                    coins.value += earned;
                    
                    // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –æ—Ç –¥—Ä—É–∑–µ–π
                    if (friends.value.length > 0) {
                        const passiveEarned = totalPassiveEarnings.value;
                        coins.value += passiveEarned;
                    }
                    
                    // –ö—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä
                    if (cryptoMinerActive.value && cryptoMinerTimeLeft.value > 0) {
                        const timestamp = Date.now();
                        const seed = (timestamp % 1000) / 1000;
                        const random1 = Math.random();
                        const random2 = Math.random();
                        const combinedRandom = (random1 + random2 + seed) / 3;
                        
                        if (combinedRandom < currentCryptoChance.value) {
                            realTokens.value += 1;
                            showNotify(`üé∞ –ö—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä –Ω–∞—à–µ–ª 1 MRT!`, 'crypto');
                            const clickArea = document.querySelector('.click-area');
                            if (clickArea) {
                                const rect = clickArea.getBoundingClientRect();
                                addCryptoEffect(rect.left + rect.width / 2, rect.top + rect.height / 2);
                            }
                        }
                    }
                    
                    saveGame();
                }
                
                function buyUpgrade(id) {
                    const upgrade = upgrades.value.find(u => u.id === id);
                    if (!upgrade || coins.value < upgrade.cost) {
                        showNotify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TIM!', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
                    if (upgrade.level >= 100) {
                        showNotify('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!', 'error');
                        return;
                    }
                    
                    coins.value -= upgrade.cost;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * (id === 3 ? 3 : 2.5));
                    
                    if (id === 1) profitPerTap.value += 0.5;
                    if (id === 2) autoClickers.value += 5;
                    if (id === 3) profitPerTap.value *= 1.5;
                    
                    showNotify('–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!');
                    saveGame();
                }
                
                function activateCryptoMiner() {
                    const cost = cryptoMinerCost.value;
                    if (coins.value < cost) {
                        showNotify(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TIM! –ù—É–∂–Ω–æ ${formatNumber(cost)} TIM`, 'error');
                        return;
                    }
                    
                    if (cryptoMinerActive.value && cryptoMinerTimeLeft.value > 0) {
                        showNotify('–ö—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω!', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
                    if (cryptoMinerLevel.value >= 1000) {
                        showNotify('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –º–∞–π–Ω–µ—Ä–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!', 'error');
                        return;
                    }
                    
                    coins.value -= cost;
                    cryptoMinerActive.value = true;
                    cryptoMinerLevel.value++;
                    cryptoMinerEndTime.value = Date.now() + 60000;
                    
                    showNotify(`–ö—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 1 –º–∏–Ω—É—Ç—É!`, 'crypto');
                    saveGame();
                }
                
                function watchAd(type) {
                    const ad = ads.value[type];
                    
                    if (!ad.available && type !== 'instant') {
                        showNotify('–†–µ–∫–ª–∞–º–∞ –µ—â–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞!', 'error');
                        return;
                    }
                    
                    if (adWatching.value.active) {
                        showNotify('–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ä–µ–∫–ª–∞–º—ã!', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                    const now = Date.now();
                    if (ad.lastWatch && (now - ad.lastWatch) < 1000) {
                        showNotify('–°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ!', 'error');
                        return;
                    }
                    
                    adWatching.value = { 
                        active: true, 
                        timeLeft: 30, 
                        progress: 0, 
                        type: type
                    };
                    
                    const interval = setInterval(() => {
                        if (adWatching.value.timeLeft <= 0) {
                            clearInterval(interval);
                            
                            let reward = ad.reward;
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                            ad.lastWatch = Date.now();
                            
                            if (type === 'daily') {
                                ad.watchedToday++;
                                if (ad.watchedToday >= 3) {
                                    ad.available = false;
                                    ad.cooldown = 24 * 60 * 60;
                                }
                            } else if (type === 'hourly') {
                                ad.available = false;
                                ad.cooldown = 60 * 60;
                            } else if (type === 'big') {
                                ad.available = false;
                            }
                            
                            coins.value += reward;
                            totalAdEarnings.value += reward;
                            
                            const adCard = document.querySelector('.ad-card');
                            if (adCard) {
                                const rect = adCard.getBoundingClientRect();
                                addAdEffect(rect.left + rect.width / 2, rect.top + rect.height / 2, reward);
                            }
                            
                            adWatching.value.active = false;
                            showNotify(`üéâ –ü–æ–ª—É—á–µ–Ω–æ ${formatNumber(reward)} TIM –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–ª–∞–º—ã!`, 'ad');
                            saveGame();
                            return;
                        }
                        
                        adWatching.value.timeLeft--;
                        adWatching.value.progress = ((30 - adWatching.value.timeLeft) / 30) * 100;
                    }, 1000);
                }
                
                // –§—É–Ω–∫—Ü–∏–∏ –¥—Ä—É–∑–µ–π
                function generateInvite() {
                    const inviteCode = Math.random().toString(36).substr(2, 8).toUpperCase();
                    showNotify(`–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: ${inviteCode}. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å –¥—Ä—É–≥–æ–º!`);
                }
                
                function copyReferral() {
                    const link = `https://t.me/timclicker_bot?start=${userId.value}`;
                    navigator.clipboard.writeText(link)
                        .then(() => showNotify('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å –¥—Ä—É–≥–æ–º'))
                        .catch(() => showNotify('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error'));
                }
                
                function claimFriendBonus(friendId) {
                    const friend = friends.value.find(f => f.id === friendId);
                    if (!friend || friend.bonusClaimed) return;
                    
                    let bonus = 0;
                    if (friends.value.length <= 5) {
                        bonus = 50000;
                    } else {
                        bonus = 10000;
                    }
                    
                    coins.value += bonus;
                    totalReferralEarnings.value += bonus;
                    friend.bonusClaimed = true;
                    
                    showNotify(`üéâ –ü–æ–ª—É—á–µ–Ω–æ ${formatNumber(bonus)} TIM –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞!`, 'success');
                    saveGame();
                }
                
                function addFriend(name) {
                    const level = Math.floor(Math.random() * 10) + 1;
                    const passiveIncome = (Math.random() * 0.5 + 0.1) * level;
                    
                    const newFriend = {
                        id: Date.now(),
                        name: name || `–î—Ä—É–≥ ${friends.value.length + 1}`,
                        level: level,
                        passiveIncome: passiveIncome,
                        bonusClaimed: false,
                        canClaim: true,
                        coins: Math.floor(Math.random() * 500000) + 10000,
                        joinedAt: Date.now()
                    };
                    
                    friends.value.push(newFriend);
                    
                    if (newFriend.coins >= 1000000) {
                        setTimeout(() => {
                            coins.value += 10000;
                            totalReferralEarnings.value += 10000;
                            showNotify(`üéä –í–∞—à –¥—Ä—É–≥ ${newFriend.name} –¥–æ—Å—Ç–∏–≥ 1M TIM! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 10,000 TIM –±–æ–Ω—É—Å–∞!`, 'premium');
                            saveGame();
                        }, 2000);
                    }
                    
                    showNotify(`üëã –î—Ä—É–≥ ${newFriend.name} –¥–æ–±–∞–≤–ª–µ–Ω! –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å.`);
                    saveGame();
                }
                
                // –§—É–Ω–∫—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
                function convertTokens() {
                    const amount = parseFloat(convertAmount.value);
                    
                    if (isNaN(amount) || amount <= 0) {
                        showNotify('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞!', 'error');
                        return;
                    }
                    
                    if (amount < 1000000 || coins.value < amount) {
                        showNotify('–ú–∏–Ω–∏–º—É–º 1,000,000 TIM –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    if (amount > 1000000000) {
                        showNotify('–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è —Å—É–º–º–∞!', 'error');
                        return;
                    }
                    
                    const tokens = Math.floor(amount / 1000000);
                    coins.value -= amount;
                    realTokens.value += tokens;
                    convertAmount.value = '';
                    
                    showNotify(`–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ ${tokens} MRT!`, 'success');
                    saveGame();
                }
                
                function withdrawTokens() {
                    const amount = parseFloat(withdrawAmount.value);
                    
                    if (isNaN(amount) || amount <= 0) {
                        showNotify('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞!', 'error');
                        return;
                    }
                    
                    if (amount < 10 || realTokens.value < amount) {
                        showNotify('–ú–∏–Ω–∏–º—É–º 10 MRT –¥–ª—è –≤—ã–≤–æ–¥–∞', 'error');
                        return;
                    }
                    
                    if (!polygonWalletAddress.value) {
                        showNotify('–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫', 'error');
                        openFullscreen('wallet');
                        return;
                    }
                    
                    realTokens.value -= amount;
                    withdrawAmount.value = '';
                    
                    showNotify(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ ${amount} MRT –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é!`, 'success');
                    saveGame();
                }
                
                // –§—É–Ω–∫—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–∞
                function saveWallet() {
                    if (!isValidWallet.value) {
                        showNotify('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞!', 'error');
                        return;
                    }
                    
                    polygonWalletAddress.value = polygonWalletInput.value.trim();
                    localStorage.setItem('tim_wallet_address', polygonWalletAddress.value);
                    polygonWalletInput.value = '';
                    
                    showNotify('–ö–æ—à–µ–ª–µ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                    saveGame();
                }
                
                function copyWallet() {
                    if (!polygonWalletAddress.value) return;
                    navigator.clipboard.writeText(polygonWalletAddress.value)
                        .then(() => showNotify('–ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!'))
                        .catch(() => showNotify('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error'));
                }
                
                // –§—É–Ω–∫—Ü–∏–∏ Telegram Stars
                function buyStars(amount) {
                    // –≠–º—É–ª—è—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –∑–≤–µ–∑–¥
                    if (amount < 0 || amount > 10000) {
                        showNotify('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥!', 'error');
                        return;
                    }
                    
                    telegramStars.value += amount;
                    showNotify(`‚ö° –ö—É–ø–ª–µ–Ω–æ ${amount} Telegram Stars (–¥–µ–º–æ)!`, 'premium');
                    saveGame();
                }
                
                function buyTimForStars(starsCost, timAmount) {
                    if (telegramStars.value < starsCost) {
                        showNotify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!', 'error');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑—É–º–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    if (starsCost < 0 || timAmount < 0 || timAmount > 100000000) {
                        showNotify('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è!', 'error');
                        return;
                    }
                    
                    telegramStars.value -= starsCost;
                    coins.value += timAmount;
                    
                    showNotify(`–ö—É–ø–ª–µ–Ω–æ ${formatNumber(timAmount)} TIM –∑–∞ ${starsCost} –∑–≤–µ–∑–¥!`, 'premium');
                    saveGame();
                }
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
                function setPage(page) {
                    activePage.value = page;
                    fullscreenPage.value = '';
                }
                
                function openFullscreen(page) {
                    fullscreenPage.value = page;
                }
                
                function closeFullscreen() {
                    fullscreenPage.value = '';
                }
                
                // –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã
                function saveGame() {
                    try {
                        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                        const gameData = {
                            coins: coins.value, 
                            profitPerTap: profitPerTap.value, 
                            autoClickers: autoClickers.value,
                            realTokens: realTokens.value, 
                            telegramStars: telegramStars.value, 
                            friends: friends.value,
                            upgrades: upgrades.value.map(upgrade => ({
                                id: upgrade.id,
                                name: upgrade.name,
                                description: upgrade.description,
                                cost: upgrade.cost,
                                level: upgrade.level
                            })),
                            cryptoMinerLevel: cryptoMinerLevel.value,
                            cryptoMinerActive: cryptoMinerActive.value, 
                            cryptoMinerEndTime: cryptoMinerEndTime.value,
                            ads: {
                                daily: { ...ads.value.daily },
                                hourly: { ...ads.value.hourly },
                                big: { ...ads.value.big },
                                instant: { ...ads.value.instant }
                            },
                            totalAdEarnings: totalAdEarnings.value, 
                            totalReferralEarnings: totalReferralEarnings.value,
                            lastSaveTime: Date.now(),
                            userId: userId.value,
                            saveCount: saveCount.value + 1,
                            polygonWalletAddress: polygonWalletAddress.value,
                            hasShownWelcome: hasShownWelcome.value
                        };
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ StorageManager
                        const success = StorageManager.saveProgress(userId.value, gameData);
                        
                        if (success) {
                            saveCount.value++;
                            lastSaveTime.value = Date.now();
                        } else {
                            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É');
                        }
                        
                        return success;
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã:', error);
                        return false;
                    }
                }
                
                function loadGame() {
                    try {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        userId.value = StorageManager.generateUserId();
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                        const gameData = StorageManager.loadProgress(userId.value);
                        const now = Date.now();
                        
                        if (gameData) {
                            console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', gameData);
                            
                            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                            coins.value = gameData.coins || 0;
                            profitPerTap.value = gameData.profitPerTap || 1;
                            autoClickers.value = gameData.autoClickers || 0;
                            realTokens.value = gameData.realTokens || 0;
                            telegramStars.value = gameData.telegramStars || 0;
                            friends.value = gameData.friends || [];
                            
                            // –ó–∞–≥—Ä—É–∂–∞–µ–º —É–ª—É—á—à–µ–Ω–∏—è
                            if (gameData.upgrades && gameData.upgrades.length === 3) {
                                upgrades.value = gameData.upgrades.map(upgrade => ({
                                    id: upgrade.id,
                                    name: upgrade.name,
                                    description: upgrade.description,
                                    cost: upgrade.cost,
                                    level: upgrade.level
                                }));
                            }
                            
                            cryptoMinerLevel.value = gameData.cryptoMinerLevel || 0;
                            cryptoMinerActive.value = gameData.cryptoMinerActive || false;
                            cryptoMinerEndTime.value = gameData.cryptoMinerEndTime || 0;
                            
                            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–ª–∞–º—É
                            if (gameData.ads) {
                                ads.value.daily = { ...ads.value.daily, ...gameData.ads.daily };
                                ads.value.hourly = { ...ads.value.hourly, ...gameData.ads.hourly };
                                ads.value.big = { ...ads.value.big, ...gameData.ads.big };
                                ads.value.instant = { ...ads.value.instant, ...gameData.ads.instant };
                            }
                            
                            totalAdEarnings.value = gameData.totalAdEarnings || 0;
                            totalReferralEarnings.value = gameData.totalReferralEarnings || 0;
                            saveCount.value = gameData.saveCount || 0;
                            lastSaveTime.value = gameData.lastSaveTime || now;
                            hasShownWelcome.value = gameData.hasShownWelcome || false;
                            
                            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞
                            polygonWalletAddress.value = gameData.polygonWalletAddress || 
                                                         localStorage.getItem('tim_wallet_address') || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä
                            if (cryptoMinerActive.value && now > cryptoMinerEndTime.value) {
                                cryptoMinerActive.value = false;
                            }
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫—É–ª–¥–∞—É–Ω–æ–≤ —Ä–µ–∫–ª–∞–º—ã
                            if (ads.value.daily.lastWatch) {
                                const timeSinceDaily = Math.floor((now - ads.value.daily.lastWatch) / 1000);
                                if (timeSinceDaily >= 24 * 60 * 60) {
                                    ads.value.daily.available = true;
                                    ads.value.daily.watchedToday = 0;
                                    ads.value.daily.cooldown = 0;
                                } else if (ads.value.daily.watchedToday >= 3) {
                                    ads.value.daily.available = false;
                                    ads.value.daily.cooldown = 24 * 60 * 60 - timeSinceDaily;
                                }
                            }
                            
                            if (ads.value.hourly.lastWatch) {
                                const timeSinceHourly = Math.floor((now - ads.value.hourly.lastWatch) / 1000);
                                if (timeSinceHourly >= 60 * 60) {
                                    ads.value.hourly.available = true;
                                    ads.value.hourly.cooldown = 0;
                                } else {
                                    ads.value.hourly.available = false;
                                    ads.value.hourly.cooldown = 60 * 60 - timeSinceHourly;
                                }
                            }
                            
                            if (ads.value.big.lastWatch) {
                                const timeSinceBig = Math.floor((now - ads.value.big.lastWatch) / 1000);
                                if (timeSinceBig >= 24 * 60 * 60) {
                                    ads.value.big.available = true;
                                } else {
                                    ads.value.big.available = false;
                                }
                            }
                            
                            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ñ–ª–∞–π–Ω –∑–∞—Ä–∞–±–æ—Ç–æ–∫
                            const offlineEarningsCalculated = calculateOfflineEarnings();
                            if (offlineEarningsCalculated > 0) {
                                offlineEarnings.value = offlineEarningsCalculated;
                            }
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥
                            if (!hasShownWelcome.value) {
                                setTimeout(() => {
                                    showNotify('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Tim Clicker!', 'premium');
                                    hasShownWelcome.value = true;
                                    saveGame();
                                }, 500);
                            } else {
                                setTimeout(() => {
                                    showNotify(`üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –í–∞—à –±–∞–ª–∞–Ω—Å: ${formatNumber(coins.value)} TIM`, 'success');
                                }, 500);
                            }
                            
                            console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π:', saveCount.value);
                        } else {
                            // –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–¥–∏–Ω —Ä–∞–∑
                            resetGame();
                            hasShownWelcome.value = true;
                            setTimeout(() => {
                                showNotify('üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Tim Clicker! –ù–∞—á–Ω–∏—Ç–µ –∫–ª–∏–∫–∞—Ç—å!', 'premium');
                            }, 500);
                        }
                        
                        // –°—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        saveGame();
                        
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:', error);
                        resetGame();
                        hasShownWelcome.value = true;
                        setTimeout(() => {
                            showNotify('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –Ω–∞—á–∞—Ç–∞ –Ω–æ–≤–∞—è –∏–≥—Ä–∞', 'error');
                        }, 500);
                    }
                }
                
                function resetGame() {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    if (!userId.value) {
                        userId.value = StorageManager.generateUserId();
                    }
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    coins.value = 0; 
                    profitPerTap.value = 1; 
                    autoClickers.value = 0; 
                    realTokens.value = 0;
                    telegramStars.value = 0; 
                    friends.value = []; 
                    upgrades.value = [
                        { id: 1, name: '–£—Å–∏–ª–∏—Ç–µ–ª—å –∫–ª–∏–∫–∞', description: '+0.5 TIM –∑–∞ –∫–ª–∏–∫', cost: 1000, level: 0 },
                        { id: 2, name: '–ê–≤—Ç–æ–º–∞–π–Ω–µ—Ä', description: '+5 TIM –≤ –º–∏–Ω—É—Ç—É', cost: 5000, level: 0 },
                        { id: 3, name: '–ú–Ω–æ–∂–∏—Ç–µ–ª—å', description: 'x1.5 –¥–æ—Ö–æ–¥ –æ—Ç –∫–ª–∏–∫–æ–≤', cost: 25000, level: 0 }
                    ];
                    cryptoMinerLevel.value = 0; 
                    cryptoMinerActive.value = false; 
                    cryptoMinerEndTime.value = 0;
                    ads.value = {
                        daily: { available: true, reward: 50000, cooldown: 0, watchedToday: 0, lastWatch: 0 },
                        hourly: { available: true, reward: 10000, cooldown: 0, lastWatch: 0 },
                        big: { available: true, reward: 200000, lastWatch: 0 },
                        instant: { available: true, reward: 5000, lastWatch: 0 }
                    };
                    totalAdEarnings.value = 0; 
                    totalReferralEarnings.value = 0;
                    offlineEarnings.value = 0;
                    lastSaveTime.value = Date.now();
                    activePage.value = 'click';
                    saveCount.value = 0;
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—à–µ–ª–µ–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
                    polygonWalletAddress.value = localStorage.getItem('tim_wallet_address') || '';
                }
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
                function startGameLoops() {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫
                    setInterval(() => { 
                        if (autoClickers.value > 0) {
                            coins.value += autoClickers.value; 
                            saveGame();
                        }
                    }, 60000);
                    
                    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                    setInterval(() => {
                        saveGame();
                    }, 30000);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫—Ä–∏–ø—Ç–æ-–º–∞–π–Ω–µ—Ä–∞
                    setInterval(() => {
                        if (cryptoMinerActive.value && cryptoMinerTimeLeft.value <= 0) {
                            cryptoMinerActive.value = false;
                        }
                    }, 1000);
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–ª–¥–∞—É–Ω–æ–≤ —Ä–µ–∫–ª–∞–º—ã
                    setInterval(() => {
                        if (ads.value.daily.cooldown > 0) {
                            ads.value.daily.cooldown--;
                            if (ads.value.daily.cooldown <= 0) {
                                ads.value.daily.available = true;
                                ads.value.daily.watchedToday = 0;
                            }
                        }
                        if (ads.value.hourly.cooldown > 0) {
                            ads.value.hourly.cooldown--;
                            if (ads.value.hourly.cooldown <= 0) {
                                ads.value.hourly.available = true;
                            }
                        }
                    }, 1000);
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                onMounted(() => {
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
                    document.addEventListener('gesturestart', e => e.preventDefault());
                    document.addEventListener('touchmove', e => { if (e.scale !== 1) e.preventDefault(); }, { passive: false });
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
                    if (window.Telegram?.WebApp) {
                        const tg = window.Telegram.WebApp;
                        tg.ready(); 
                        tg.expand();
                        const user = tg.initDataUnsafe?.user;
                        if (user) {
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram ID –∫–∞–∫ —á–∞—Å—Ç—å user ID
                            userId.value = `tg_${user.id}_${Date.now()}`;
                            localStorage.setItem('tim_user_id', userId.value);
                        }
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É
                    loadGame();
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ —Ü–∏–∫–ª—ã
                    startGameLoops();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    setTimeout(() => isReady.value = true, 800);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    window.addEventListener('beforeunload', () => {
                        saveGame();
                    });
                });
                
                return {
                    // –°–æ—Å—Ç–æ—è–Ω–∏—è
                    isReady, coins, profitPerTap, autoClickers, activePage, fullscreenPage, realTokens,
                    polygonWalletAddress, polygonWalletInput, convertAmount, withdrawAmount, friends, userId,
                    telegramStars, cryptoMinerLevel, cryptoMinerActive, cryptoEffects, ads, adWatching,
                    adEffects, notification, upgrades, totalReferralEarnings, totalPassiveEarnings,
                    totalAdEarnings, offlineEarnings,
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
                    isValidWallet, cryptoMinerTimeLeft, cryptoMinerCost, currentCryptoChance,
                    
                    // –§—É–Ω–∫—Ü–∏–∏
                    formatNumber, formatTime, mine, buyUpgrade, activateCryptoMiner, watchAd, generateInvite,
                    copyReferral, claimFriendBonus, addFriend, convertTokens, withdrawTokens, saveWallet,
                    copyWallet, buyStars, buyTimForStars, setPage, openFullscreen, closeFullscreen, showNotify,
                    claimOfflineEarnings
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
